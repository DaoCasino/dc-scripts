version: "2.1"

networks:
  dc_network:
    driver: bridge

services:
  # ethereum test rpc network based on ganache-cli 
  dc_protocol:
    labels:
      - "TestRPC on port 1406"
      - "truffle ganache-cli"
    image:
      daocasino/protocol
    ports:
      - 1406:8545
    volumes:
      - ./protocol:/protocol
    networks:
       - dc_network

  dc_signal:
    labels:
      - "WebRTC signal"
      - "rendezvous"
    image:
      libp2p/websocket-star-rendezvous:release
    ports:
      - 9090:9090
    environment:
      - DISABLE_METRICS=1
    networks:
      - dc_network
  
  # Bankroller node / casino backend
  # service watch dapp logic and reload node if his change 
  dc_bankroller:
    labels:
      - "dapp casino backend"
    depends_on:
      - dc_protocol
    image:
      daocasino/bankroller
    volumes:
      - ./protocol:/protocol
      - ./bankroller/dapps/:/bankroller/data_sdk/dapps/
      - ${DAPP_PATH}:/bankroller/data_sdk/dapps/sdk_dapp/
    entrypoint: 
      ["sh", "./run_${DC_NETWORK}_env.sh"]
    environment:
      - privateKey=${PRIVATE_KEY}
      - signal=/dns4/dc_signal/tcp/9090/ws/p2p-websocket-star/
    networks:
      - dc_network

